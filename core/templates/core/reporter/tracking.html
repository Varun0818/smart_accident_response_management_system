{% extends 'core/base.html' %}

{% block extra_css %}
<style>
body {
    background: linear-gradient(120deg, #fff 60%, #bfcfff 100%) no-repeat;
    min-height: 100vh;
}
.panel {
    background: #fff;
    border-radius: 2.1rem;
    box-shadow: 0 0 0 2px #f5f5fc, 0 8px 50px 0 #b5c8fd24, 0 0 80px 14px #dde7ff28;
    padding: 2.2rem 2.8rem 1.6rem 2.8rem;
    max-width: 550px;
    margin: 2.6rem auto 2.5rem auto;
    position: relative;
    transition: box-shadow .17s;
}
.panel:before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 2.1rem;
    box-shadow: 0 0 55px 14px #b3a7fc30;
    opacity: 0.24;
    z-index: 0;
    filter: blur(15px);
}
.card-header {
    border-radius: 2.1rem 2.1rem 0 0 !important;
    background: linear-gradient(90deg,#bcb5fd 2%,#bca2fa 55%,#c6a8f9 120%) !important;
    color: #fff !important;
    font-size: 1.43rem;
    font-weight: 800;
    letter-spacing: .2px;
    text-align: center;
    border: none !important;
    box-shadow: none;
}
.status-summary {
    background: #f2f7fa;
    text-align: center;
    border-radius: 1.2rem;
    box-shadow: 0 1.5px 8px #bfbbfe12;
    padding: 1.8rem 1rem 1.3rem 1rem;
    margin-top: 1.3rem;
}
.status-summary img { height: 53px;}
.status-summary h3 { margin-top:.7em;margin-bottom:.25em;}
.status-summary small {color:#6a78a1}
.detail-table th { text-align:right; color:#495;}
.severity-badge {
    font-size: 1rem;
    font-weight: 700;
    border-radius: .8rem;
    padding:3px 13px;
    margin-left: .7rem;
    background: #fbe0ee !important;
    color: #d45381 !important;
}
#map {
    height: 180px;
    border-radius: 1.1rem;
    margin: 10px 0 18px 0;
    background: #f5f7fa;
    box-shadow: 0 2px 14px #b5baf71a;
}
.mt-4{margin-top:1.6rem !important;}
.mb-2{margin-bottom:.7rem !important;}
@media (max-width: 750px){
    .panel{padding:1.2rem .2rem;max-width:98vw;}
    .card-header{font-size:1.06rem;}
    #map{height:100px;}
}
</style>
{% endblock %}

{% block content %}
<div class="panel">
    <div class="card-header mb-3">
        <h4 class="mb-0">Accident Response Status</h4>
    </div>
    <div>
        <b style="margin-left:.23em;">Live Tracking</b>
        <div id="map"></div>
    </div>
    <div class="status-summary mb-4">
        <img src="https://cdn-icons-png.flaticon.com/512/2967/2967253.png" alt="Ambulance">
        <h3>Ambulance En Route</h3>
        <small>{% if responder %}Responding: {{ responder.user.username }}{% else %}None is responding to your emergency{% endif %}</small>
        <div class="d-flex justify-content-around mt-3">
            <div>
                <div><b>Distance</b></div>
                <b style="font-size: 1.5rem;">{{ distance_km }} <span style="font-size:.95rem;">km</span></b>
            </div>
            <div>
                <div><b>ETA</b></div>
                <b style="font-size: 1.5rem;">{{ eta_min }} <span style="font-size:.95rem;">min</span></b>
            </div>
        </div>
    </div>
    <h6 class="mt-4 mb-2">Report Details</h6>
    <table class="table detail-table">
        <tr>
            <th>Description:</th>
            <td>{{ report.description }}</td>
        </tr>
        <tr>
            <th>Severity:</th>
            <td><span class="severity-badge">{{ report.severity }}</span></td>
        </tr>
        <tr>
            <th>Reported At:</th>
            <td>{{ report.timestamp }}</td>
        </tr>
    </table>
</div>
{% endblock %}

{% block extra_js %}
<script>
function initMap() {
    var map = new google.maps.Map(document.getElementById('map'), {zoom: 13, center: {lat: {{ report.latitude }}, lng: {{ report.longitude }}}});
    var reporter = new google.maps.Marker({
      position: { lat: {{ report.latitude }}, lng: {{ report.longitude }} },
      map: map,
      title: "Incident Location",
      icon: { url: "http://maps.google.com/mapfiles/ms/icons/red-dot.png" }
    });
    {% if responder %}
    var responderMarker = new google.maps.Marker({
      position: { lat: {{ responder.latitude }}, lng: {{ responder.longitude }} },
      map: map,
      title: "Ambulance Location",
      icon: { url: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png" }
    });
    {% endif %}
}
window.initMap = initMap;
</script>
<script async src="https://maps.googleapis.com/maps/api/js?key=Your_API_Key&callback=initMap"></script>
{% endblock %}
